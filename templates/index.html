<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Centro Militar de Documentos</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <header>
        <img src="{{ url_for('static', filename='images/logo.png') }}" alt="Logo Militar" class="logo">
        <h1>CENTRO MILITAR<br>DE DOCUMENTOS</h1>
    </header>
    
    <div class="user-info">
        {% if session.user %}
        <p>Usuario: {{ session.user }}</p>
        <a href="{{ url_for('logout') }}" class="btn-logout">Cerrar sesión</a>
        {% endif %}
    </div>
    
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            <div class="flash-messages">
                {% for category, message in messages %}
                    <div class="alert alert-{{ category }}">{{ message }}</div>
                {% endfor %}
            </div>
        {% endif %}
    {% endwith %}
    
    <div class="upload-search-container">
        <form class="upload-form" action="{{ url_for('upload') }}" method="POST" enctype="multipart/form-data">
            <input type="file" name="file" id="fileInput">
            <label for="fileInput" class="upload-btn">Seleccionar Documento</label>
            <button type="submit" class="submit-btn">Subir</button>
        </form>
        <div class="search-container">
            <div class="search-box">
                <input type="text" id="searchInput" onkeyup="searchDocuments()" placeholder="Buscar...">
            </div>
        </div>
    </div>
    
    <section class="recent-docs">
        <h2>DOCUMENTOS RECIENTES</h2>
        <div class="doc-list" id="documentsList">
            {% if dropbox_files %}
                {% for doc in dropbox_files %}
                <div class="doc-card">
                    <img src="{{ url_for('static', filename='images/doc_icon.png') }}" alt="Icono Documento">
                    <h3>{{ doc.title }}</h3>
                    <div class="doc-actions">
                        <a href="{{ url_for('preview', file_id=file['file_id']) }}" class="btn btn-primary">Ver documento</a>
                        <a href="{{ doc.url }}" class="btn download-btn" download>Descargar</a>
                    </div>
                </div>
                {% endfor %}
            {% else %}
                <p class="no-docs">No hay documentos disponibles.</p>
            {% endif %}
        </div>
    </section>
    
    <script>
        function searchDocuments() {
            const query = document.getElementById("searchInput").value.toLowerCase();
            const docCards = document.querySelectorAll(".doc-card");
            
            docCards.forEach(card => {
                const title = card.querySelector("h3").textContent.toLowerCase();
                card.style.display = title.includes(query) ? "block" : "none";
            });
            
            // Mostrar mensaje si no hay resultados
            const visibleCards = document.querySelectorAll(".doc-card[style='display: block']");
            const noResults = document.getElementById("no-results");
            
            if (visibleCards.length === 0 && query !== "") {
                if (!noResults) {
                    const message = document.createElement("p");
                    message.id = "no-results";
                    message.className = "no-results";
                    message.textContent = "No se encontraron documentos que coincidan con la búsqueda.";
                    document.getElementById("documentsList").appendChild(message);
                }
            } else if (noResults) {
                noResults.remove();
            }
        }
        
        // Para mostrar el nombre del archivo seleccionado
        document.getElementById('fileInput').addEventListener('change', function() {
            const fileName = this.files[0]?.name || 'Ningún archivo seleccionado';
            const label = document.querySelector('label[for="fileInput"]');
            label.textContent = fileName.length > 20 ? fileName.substring(0, 17) + '...' : fileName;
        });
    </script>
</body>
</html>
